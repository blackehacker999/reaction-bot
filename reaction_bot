import requests
import time
import os

# =================== CONFIGURATION ===================
def read_token_from_file(file_path):
    with open(file_path, 'r') as file:
        return file.read().strip()

BOT_TOKEN = read_token_from_file('token.txt')
bot = telebot.TeleBot(BOT_TOKEN)
CHAT_ID = "@TestingCyberAmarjit"      # <-- Apna channel username e.g. @CyberAmarjit
REACTION = "üî•"                         # <-- Emoji jo reaction me dena hai

# Telegram API Base URL
BASE_URL = f"https://api.telegram.org/bot{BOT_TOKEN}"

# =================== COLORS ===================
RED = "\033[91m"
GREEN = "\033[92m"
RESET = "\033[0m"

# =================== BANNER ===================
def show_banner():
    os.system("cls" if os.name == "nt" else "clear")

    # Top Heading
    print(f"{RED}===== CYBER AMARJIT ====={RESET}\n")

    # Banner Text
    banner = f"""
{GREEN}
   
  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù     ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   
‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   
‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   
‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù   
          AMARJIT - Telegram Reaction Bot
{RESET}
    """
    print("#BANNER#")
    print(banner)
    print("üöÄ Telegram Reaction Bot Started!\n")

# =================== GET LATEST MESSAGE ===================
def get_latest_message_id():
    """Channel me latest post ka message_id fetch karega."""
    url = f"{BASE_URL}/getUpdates"
    try:
        response = requests.get(url).json()
        if "result" in response and len(response["result"]) > 0:
            for update in reversed(response["result"]):
                try:
                    if "channel_post" in update and update["channel_post"]["chat"]["id"]:
                        return update["channel_post"]["message_id"]
                except KeyError:
                    continue
    except Exception as e:
        print("‚ùå Error fetching updates:", e)
    return None

# =================== ADD REACTION ===================
def add_reaction(message_id):
    """Channel ke post par reaction add karega."""
    url = f"{BASE_URL}/setMessageReaction"
    data = {
        "chat_id": CHAT_ID,
        "message_id": message_id,
        "reaction": [{"type": "emoji", "emoji": REACTION}]
    }
    try:
        response = requests.post(url, json=data).json()
        return response
    except Exception as e:
        return {"ok": False, "error": str(e)}

# =================== MAIN FUNCTION ===================
def main():
    show_banner()
    last_message_id = None

    while True:
        message_id = get_latest_message_id()

        if message_id and message_id != last_message_id:
            print(f"üìå New Post Detected! Message ID: {message_id}")
            result = add_reaction(message_id)
            if result.get("ok"):
                print("‚úÖ Reaction Added Successfully!")
            else:
                print("‚ùå Error Adding Reaction:", result)
            last_message_id = message_id

        time.sleep(3)  # 3 second delay

if __name__ == "__main__":
    main()
